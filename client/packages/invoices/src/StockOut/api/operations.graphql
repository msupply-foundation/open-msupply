fragment StockOutLine on InvoiceLineNode {
  __typename
  id
  type
  batch
  expiryDate
  numberOfPacks
  prescribedQuantity
  packSize
  invoiceId
  costPricePerPack
  sellPricePerPack
  note
  totalBeforeTax
  totalAfterTax
  taxPercentage
  note
  itemName
  itemVariantId
  vvmStatusId

  vvmStatus {
    id
    description
  }

  item {
    __typename
    id
    name
    code
    unitName
    isVaccine
    doses
  }

  location {
    __typename
    id
    name
    code
    onHold
  }

  stockLine {
    __typename
    id
    itemId
    batch
    availableNumberOfPacks
    totalNumberOfPacks
    onHold
    sellPricePerPack
    costPricePerPack
    packSize
    expiryDate
    item {
      name
      code
      isVaccine
      doses
    }
    volumePerPack
  }
}

fragment DraftStockOutLine on DraftStockOutLineNode {
  __typename
  id
  stockLineId
  numberOfPacks
  packSize
  batch
  expiryDate
  sellPricePerPack
  inStorePacks
  availablePacks
  stockLineOnHold
  dosesPerUnit
  itemVariantId
  vvmStatusId
  location {
    __typename
    id
    name
    code
    onHold
  }
  vvmStatus {
    __typename
    id
    priority
    unusable
    description
  }
  donor(storeId: $storeId) {
    id
    name
  }
  program {
    name
    id
  }
  campaign {
    name
    id
  }
  volumePerPack
}

query getOutboundEditLines(
  $storeId: String!
  $itemId: String!
  $invoiceId: String!
) {
  # Base item info
  items(
    storeId: $storeId
    filter: { id: { equalTo: $itemId }, isActive: true }
  ) {
    ... on ItemConnector {
      __typename
      nodes {
        __typename
        id
        unitName
        name
        isVaccine
        doses
        itemDirections {
          ...ItemDirection
        }
      }
    }
  }

  # The draft lines
  draftStockOutLines(
    storeId: $storeId
    itemId: $itemId
    invoiceId: $invoiceId
  ) {
    ... on DraftStockOutItemData {
      placeholderQuantity
      prescribedQuantity
      note
      draftLines {
        ...DraftStockOutLine
      }
    }
  }
}
