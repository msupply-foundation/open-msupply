{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "Clinician": {
      "properties": {
        "firstName": {
          "type": "string"
        },
        "id": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        }
      },
      "type": "object"
    },
    "EncounterStatus": {
      "enum": ["SCHEDULED", "COMPLETED", "CANCELLED"],
      "type": "string"
    },
    "FamilyPlanning": {
      "properties": {
        "contraception": {
          "$ref": "#/definitions/YesNo",
          "description": "13197004 Contraception"
        },
        "pregnant": {
          "description": "77386006 Pregnant",
          "enum": ["Yes", "No", "Breastfeeding"],
          "type": "string"
        }
      },
      "type": "object"
    },
    "HIVCareEncounter": {
      "properties": {
        "arvMedication": {
          "if": {
            "properties": {
              "regimenStatus": {
                "enum": ["START", "CHANGE", "STOP"]
              }
            },
            "required": ["regimenStatus"]
          },
          "properties": {
            "adherenceScore": {
              "description": "Antiretroviral adherence score [%]",
              "type": "number"
            },
            "endOfSupply": {
              "format": "date-time",
              "type": "string"
            },
            "otherRegimen": {
              "type": "string"
            },
            "prophylaxisMedication": {
              "items": {
                "enum": [
                  "Albendazole",
                  "Amoxicilin",
                  "Artemeter Injection",
                  "Chlorampanical",
                  "Chloroquine",
                  "Ciproxicilin",
                  "CMP Injection",
                  "Cotrimoxazole",
                  "Crystopan",
                  "Fansidar",
                  "Flucloxicilin",
                  "Fluconazole"
                ],
                "type": "string"
              },
              "type": "array"
            },
            "quantityDispensed": {
              "description": "Number of pills dispensed in this encounter",
              "minimum": 0,
              "type": "number"
            },
            "quantityPrescribed": {
              "description": "Number of pills on hand at the end of the encounter.",
              "type": "number"
            },
            "regimen": {
              "description": "Antiretroviral treatment regimen",
              "enum": [
                "1a-New",
                "1a-Old",
                "1b-New",
                "1b-Old",
                "2a-New",
                "2a-Old",
                "2b-New",
                "2b-Old",
                "2c-New",
                "3a-New",
                "3a-Old",
                "3b-New",
                "3b-Old",
                "3c-New",
                "4a-New",
                "4a-Old",
                "4b-New",
                "4b-Old",
                "4c-New",
                "4c-Old",
                "5a-New",
                "5a-Old",
                "5b-New",
                "5b-Old",
                "6a-New",
                "6a-Old",
                "6b-New",
                "6b-Old",
                "6c-New",
                "6c-Old",
                "Other - please specify"
              ],
              "type": "string"
            },
            "regimenChangeNote": {
              "type": "string"
            },
            "regimenChangeReason": {
              "enum": [
                "51",
                "52",
                "53",
                "54",
                "55",
                "56",
                "57",
                "58",
                "99",
                "101",
                "102",
                "103",
                "104",
                "105",
                "106",
                "107",
                "108",
                "109",
                "110",
                "111",
                "112",
                "113",
                "114",
                "115",
                "116",
                "117",
                "118",
                "119",
                "120",
                "121",
                "122",
                "123",
                "131",
                "132",
                "141",
                "142",
                "143",
                "144",
                "145",
                "146",
                "147",
                "148",
                "149",
                "151"
              ],
              "type": "string"
            },
            "regimenStatus": {
              "description": "Antiretroviral treatment status",
              "enum": ["NO", "START", "CONTINUE", "CHANGE", "STOP"],
              "type": "string"
            },
            "regimenType": {
              "enum": [
                "First Line - Adult",
                "Second Line - Adult",
                "First Line - Paeds 20-30kg",
                "Second Line - Paeds 20-30kg",
                "First Line - Paeds <20kg",
                "Second Line - Paeds <20kg",
                "Other"
              ],
              "type": "string"
            },
            "relevantCoMedication": {
              "enum": [
                "Asthma medication",
                "Diabetes medication",
                "Heart condition medication",
                "Kidney medication",
                "Liver medication"
              ],
              "type": "string"
            },
            "remainingPillCount": {
              "description": "Number of units pills that the patient has left from the last dispensing event (last encounter)",
              "minimum": 0,
              "type": "number"
            }
          },
          "then": {
            "required": ["regimen", "regimenChangeReason"]
          },
          "type": "object"
        },
        "biochem": {
          "properties": {
            "alt": {
              "type": "number"
            },
            "ast": {
              "description": "[IU/L]",
              "type": "number"
            },
            "bilirubin": {
              "type": "number"
            },
            "cd4": {
              "description": "[+cells/mm^3]",
              "type": "number"
            },
            "uec": {
              "description": "UEC (Cr)",
              "type": "number"
            }
          },
          "type": "object"
        },
        "clinician": {
          "$ref": "#/definitions/Clinician"
        },
        "createdDatetime": {
          "description": "Date time when the encounter was made, e.g. when an clinician schedule the encounter.",
          "format": "date-time",
          "type": "string"
        },
        "endDatetime": {
          "description": "Encounter end date and time",
          "format": "date-time",
          "type": "string"
        },
        "familyPlanning": {
          "$ref": "#/definitions/FamilyPlanning"
        },
        "genderBasedViolence": {
          "properties": {
            "intimatePartnerViolence": {
              "description": "Victim of intimate partner abuse 706893006",
              "enum": ["Yes", "No", "N/A"],
              "type": "string"
            },
            "postServiceProvided": {
              "description": "Post GBV Services provided?",
              "enum": ["Yes", "No", "Declined", "N/A"],
              "type": "string"
            },
            "rape": {
              "description": "Victim of rape 42085001",
              "enum": ["Yes", "No", "N/A"],
              "type": "string"
            },
            "receivedServiceType": {
              "description": "Service Type",
              "enum": [
                "Received at least service (not min. package per type of violence)",
                "Received min package per type of violence",
                "N/A"
              ],
              "type": "string"
            },
            "referredForExternalServices": {
              "description": "Referred for external services?",
              "enum": ["Yes", "No", "N/A"],
              "type": "string"
            },
            "screened": {
              "description": "Screened for Gender Based Violence",
              "enum": ["Positive", "Negative", "Declined", "NotDone"],
              "type": "string"
            },
            "type": {
              "description": "Type of Gender Based Violence",
              "enum": ["Physical", "Psychological", "Sexual", "N/A"],
              "type": "string"
            }
          },
          "type": "object"
        },
        "haem": {
          "properties": {
            "fbe": {
              "properties": {
                "fbeHb": {
                  "description": "Hb [g/dL]",
                  "type": "number"
                },
                "fbePlt": {
                  "description": "Plt",
                  "type": "number"
                },
                "fbeWCC": {
                  "description": "WCC",
                  "type": "number"
                }
              },
              "type": "object"
            },
            "hepBSAg": {
              "enum": ["Pos", "Neg"],
              "type": "string"
            },
            "rbslToFbsl": {
              "description": "RBSL/FBSL",
              "type": "string"
            },
            "tlc": {
              "description": "[+cells/mm^3]",
              "type": "number"
            },
            "tpha": {
              "enum": ["Pos", "Neg"],
              "type": "string"
            }
          },
          "type": "object"
        },
        "hcvCrag": {
          "properties": {
            "crAgResult": {
              "enum": ["Positive", "Negative", "Inc"],
              "type": "string"
            },
            "crAgTitre": {
              "type": "string"
            },
            "hcv": {
              "enum": ["Positive", "Negative"],
              "type": "string"
            }
          },
          "type": "object"
        },
        "indexTesting": {
          "properties": {
            "indexTestingAccepted": {
              "enum": ["Yes", "No", "N/A"],
              "type": "string"
            },
            "indexTestingOffered": {
              "enum": ["Yes", "No", "Declined"],
              "type": "string"
            },
            "ipvRisk": {
              "$ref": "#/definitions/YesNo"
            }
          },
          "required": ["indexTestingAccepted"],
          "type": "object"
        },
        "notes": {
          "description": "An overall note for additional comments about the encounter",
          "items": {
            "$ref": "#/definitions/Note"
          },
          "type": "array"
        },
        "physicalExamination": {
          "properties": {
            "bloodPressure": {
              "description": "75367002\tBlood pressure [mmHg]",
              "properties": {
                "diastolic": {
                  "maximum": 999,
                  "minimum": 0,
                  "type": "number"
                },
                "systolic": {
                  "maximum": 999,
                  "minimum": 0,
                  "type": "number"
                }
              },
              "required": ["systolic", "diastolic"],
              "type": "object"
            },
            "bodyMassIndex": {
              "description": "60621009\tBody mass index (BMI)",
              "type": "number"
            },
            "height": {
              "description": "50373000\tBody height measure [m]",
              "examples": ["1.55", "0.92", "1.75"],
              "pattern": "^\\d\\.\\d{2}$",
              "title": "Height in m",
              "type": "string"
            },
            "midUpperArmCircumference": {
              "description": "284473002\tMid upper arm circumference (MUAC) [cm]",
              "examples": ["23.0", "21.4"],
              "pattern": "^\\d+\\.\\d+$",
              "title": "MUAC in cm",
              "type": "string"
            },
            "nutrition": {
              "properties": {
                "nutritionalStatus": {
                  "description": "366364004  nutritional status",
                  "enum": ["UNDER_NOURISHED", "WELL_NOURISHED", "OVERWEIGHT"],
                  "type": "string"
                },
                "nutritionalSupportNeeded": {
                  "$ref": "#/definitions/YesNo"
                }
              },
              "type": "object"
            },
            "opportunisticInfections": {
              "items": {
                "enum": [
                  "411 - 1 - (1) Asymptomatic",
                  "412 - 1 - (1) Persistent generalized lymphdenopathy (PGL)",
                  "421 - 2 - (2) Moderate unexplained weight loss (<10% of presumed of measured body weight)",
                  "424 - 2 - (4) Angular cheilitis",
                  "425 - 2 - (4) Recurrent oral ulcerations (2 or more episodes in 6 months",
                  "426 - 2 - (4) Papular pruritic eruptions",
                  "427 - 2 - (4) Seborrhoeic dermatitis",
                  "428 - 2 - (4) Fungal nail infections of fingers",
                  "429 - 2 - (5) Herpes zoster (past or current episodes. in last 2 years)",
                  "430 - 2 - (6) Recurrent respiratory tract infections (RTIs, sinusitis, bronchitis, otitis media, pharyngitis)",
                  "431 - 3 - (7) Severe weight loss (> 10% of presumed or measuured body weight)",
                  "432 - 3 - (8) Unexplained chronic diarrhoea for longer than one month",
                  "433 - 3 - (9) Unexplained persistent fever (intermittent or constant for longer than one month)",
                  "434 - 3 - (10) Oral candidiasis",
                  "435 - 3 - (11) Oral hairy leukoplakia",
                  "436 - 3 - (12) Pulmonary tuberculosis (TB) diagnosed in the last two years",
                  "437 - 3 - Acute necrotizing ulcerative stomatitis, gingivitis or periodontitis",
                  "439 - 3 - Unexplained aenemia (<8 g/dl), and or neutropenia (<500/mm3) and or thrombocytopenia (<50 000/mm3) for more...",
                  "440 - 3 - Severe scabies (Norwegian scabies)",
                  "441 - 4 - (14) HIV wasting syndrome",
                  "442 - 4 - (15) Pneumocystis pneumonia",
                  "443 - 4 - Reccurent severe or radiological bacterial pneumonia (2 or more episodes within one year)",
                  "444 - 4 - (16) Central nervous system (CNS) toxoplasmosis",
                  "445 - 4 - (17) Cryptosporidiosis (diahorea more than 1 month)",
                  "446 - 4 - Extrapulmonary Cryptosporidiosis",
                  "448 - 4 - (18) Cryptococcal meningitis or other extrapulmonary disease",
                  "450 - 4 - (20) Herpes simplex infection (orolabial, genital or anorectal of more than one month's duuration)",
                  "451 - 4 - (21) Progressive multifocal leukoencephalopathy (PML)",
                  "452 - 4 - (22) Any disseminated mycosis (e.g. histoplasmosis, coccidiomycosis, peniciliosis)",
                  "453 - 4 - (23) Candida of trachea, bronchi or lungs",
                  "454 - 4 - (23) Oesophageal candidiasis",
                  "455 - 4 - (24) Disseminated non-tuberculous mycobacteria infection",
                  "457 - 4 - (25) Non-typhoidal salmonella septicaemia (2 or more episodes in one year)",
                  "458 - 4 - (26) Extrapulmonary tuberculosis",
                  "459 - 4 - (27) Lymphoma (cerebral or B cell non-Hodgkin)",
                  "460 - 4 - (28) Kaposi's sarcoma",
                  "461 - 4 - (29) HIV encephalopathy",
                  "462 - 4 - Invasive cervical carcinoma",
                  "463 - 4 - Visceral leishmaniasis",
                  "465 - 4 - Unexplained bilateral paralysis",
                  "469 - 4 - Isosporiasis"
                ],
                "type": "string"
              },
              "type": "array"
            },
            "symptoms": {
              "items": {
                "enum": [
                  "Anaemia",
                  "Abdominal Pain",
                  "Burning/Numb/Tingling",
                  "Cryptococcal Meningitis",
                  "Dizzy",
                  "Anxiety",
                  "Nightmare",
                  "Depression",
                  "Neuritis",
                  "Cough",
                  "Diarrhoea",
                  "Difficulty Breathing",
                  "Dementia",
                  "HIV Encephalopathy",
                  "Fatigue",
                  "Fat changes",
                  "Fever",
                  "Genital Ulcer Disease",
                  "Headache",
                  "Immune Reconstitution Inflammatory Syndrome",
                  "Jaundice",
                  "Kaposi's Sarcoma",
                  "Lactic acidosis",
                  "Molluscum",
                  "Nausea",
                  "Osephageal Candidiasis",
                  "Pneumonia",
                  "Pneumo Cystis Pneumonia",
                  "Parotid Enlargement",
                  "Pelvic Inflammatory Disease",
                  "Papular Pruritic Eruptions",
                  "Rash",
                  "Thrush - oral / vaginal",
                  "Urethral Discharge",
                  "Ulcers - mouth or other",
                  "Weight loss",
                  "Herpes Zoster"
                ],
                "type": "string"
              },
              "type": "array"
            },
            "weight": {
              "description": "735395000\tCurrent body weight [kg]",
              "examples": ["75.1", "60.0"],
              "pattern": "^\\d+\\.\\d+$",
              "title": "Weight in kg",
              "type": "string"
            },
            "whoStaging": {
              "description": "420721002 Acquired immunodeficiency syndrome-associated disorder (disorder)",
              "enum": [
                "STAGE_1_ASYMPTOMATIC",
                "STAGE_2_MILDLY_SYMPTOMATIC",
                "STAGE_3_MODERATELY_SYMPTOMATIC",
                "STAGE_4_SEVERELY_SYMPTOMATIC"
              ],
              "title": "WHO Staging",
              "type": "string"
            }
          },
          "type": "object"
        },
        "referral": {
          "properties": {
            "note": {
              "type": "string"
            },
            "referredTo": {
              "items": {
                "enum": [
                  "PMTCT",
                  "HBC",
                  "PLHA Support Group/Club",
                  "Orphan and vulnerable children group",
                  "Medical specialty",
                  "Nutritional Support",
                  "Legal",
                  "Medical Ward",
                  "TB Ward",
                  "Other"
                ],
                "type": "string"
              },
              "type": "array"
            }
          },
          "type": "object"
        },
        "riskBehaviour": {
          "$ref": "#/definitions/RiskBehaviour"
        },
        "startDatetime": {
          "description": "Encounter start date and time",
          "format": "date-time",
          "type": "string"
        },
        "status": {
          "$ref": "#/definitions/EncounterStatus"
        },
        "tuberculosis": {
          "properties": {
            "cxr": {
              "type": "string"
            },
            "tbGeneXpert": {
              "enum": [
                "NOT_DETECTED",
                "POSITIVE_RIF_SENSITIVE",
                "POSITIVE_RIF_RESISTANT"
              ],
              "type": "string"
            },
            "tbScreening": {
              "$ref": "#/definitions/YesNo"
            },
            "tbSputum": {
              "enum": ["NO_AFB", "POS_1", "POS_2", "POS_3"],
              "type": "string"
            },
            "tbStatus": {
              "enum": [
                "CONFMC",
                "CONFMS",
                "CONFMX",
                "INH",
                "NO",
                "REFER",
                "SP",
                "TBRX",
                "TBRXC",
                "YES"
              ],
              "type": "string"
            }
          },
          "type": "object"
        },
        "viralLoad": {
          "properties": {
            "eacDone": {
              "description": "If last VL unsuppressed",
              "type": "boolean"
            },
            "targeting": {
              "enum": ["TARGETED", "SCHEDULED"],
              "type": "string"
            },
            "tested": {
              "type": "boolean"
            },
            "viralLoadResult": {
              "description": "If not suppressed [copies/ml]",
              "minimum": 0,
              "type": "number"
            },
            "viralLoadStatus": {
              "description": "Based on viral load result",
              "enum": ["Suppressed", "Unsuppressed"],
              "type": "string"
            }
          },
          "type": "object"
        },
        "visit": {
          "properties": {
            "location": {
              "description": "Location needed if visitType is 'Refill' or 'Outreach'",
              "enum": [
                "9 Mile Clinic, NCD",
                "Angelicare Newtown",
                "Angelicare StopAIDS, NCD"
              ],
              "type": "string"
            },
            "visitType": {
              "enum": ["Outreach", "Refill", "Standard"],
              "type": "string"
            }
          },
          "type": "object"
        }
      },
      "required": ["createdDatetime", "startDatetime"],
      "type": "object"
    },
    "HIVRiskGroup": {
      "enum": [
        "LRM",
        "MSM",
        "MSW",
        "MSMSW",
        "HRM",
        "LRW",
        "HRW",
        "FSW",
        "TG",
        "TGSW"
      ],
      "type": "string"
    },
    "Note": {
      "properties": {
        "authorId": {
          "description": "authorId should be captured automatically from app state",
          "type": "string"
        },
        "authorName": {
          "description": "Practitioner's \"real\" name. Currently needs to be entered, but would ideally default to local state (but we don't yet have this in the database)",
          "type": "string"
        },
        "created": {
          "description": "Datetime when the note has been created",
          "format": "date-time",
          "type": "string"
        },
        "text": {
          "type": "string"
        }
      },
      "required": ["text", "created", "authorId", "authorName"],
      "type": "object"
    },
    "RiskBehaviour": {
      "properties": {
        "accidentalNeedlePick": {
          "description": "Have you received any of the following in the past 12 months ?: Accidental needle pick ?",
          "type": "boolean"
        },
        "forcedSexWithoutConsent": {
          "description": "Have you received any of the following in the past 12 months ?: Forced to have sex without consent ?",
          "type": "boolean"
        },
        "injectedDrugsWithoutDoctorAdvice": {
          "description": "Have you received any of the following in the past 12 months ?: Injected drugs without doctor's advice ?",
          "type": "boolean"
        },
        "numberFemaleSexualPartners6Month": {
          "description": "How many female sexual partners have you had in the last 6 months ?",
          "type": "number"
        },
        "numberMaleSexualPartners6Month": {
          "description": "How many male sexual partners have you had in the last 6 months ?",
          "type": "number"
        },
        "prostitution": {
          "description": "Have you received any of the following in the past 12 months ?: Sex in exchange for money/goods/services ?",
          "type": "boolean"
        },
        "receivedBloodTransfusion": {
          "description": "Have you received any of the following in the past 12 months ?: Received a blood transfusion ?",
          "type": "boolean"
        },
        "riskGroup": {
          "$ref": "#/definitions/HIVRiskGroup"
        },
        "sexWithSameSex": {
          "description": "Have you received any of the following in the past 12 months ?: Had sex with someone of the same sex ?",
          "type": "boolean"
        },
        "sexualTransmittedInfection": {
          "description": "Have you received any of the following in the past 12 months ?: Sexually transmitted infection (STI)",
          "type": "boolean"
        },
        "unprotectedAnalSex": {
          "description": "Have you received any of the following in the past 12 months ?: Unprotected anal sex ?",
          "type": "boolean"
        },
        "unprotectedVaginalSex": {
          "description": "Have you received any of the following in the past 12 months ?: Unprotected vaginal sex ?",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "YesNo": {
      "enum": ["Yes", "No"],
      "type": "string"
    }
  },
  "type": "object",
  "allOf": [
    {
      "$ref": "#/definitions/HIVCareEncounter"
    }
  ]
}
